server:
  port: ${PORT:8085}
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,beans
  endpoint:
    health:
      show-details: always
app:
  security:
    cors:
      allowed-origins: "http://localhost:5173,https://treg-app.vercel.app,https://front-end-three-self.vercel.app,https://www.sanoneto.com"
      allowed-methods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
      allowed-headers: "Authorization,Content-Type,X-User-Roles,X-User-Id"
spring:
  application:
    name: gateway-service
  cloud:
    gateway:
      server:
        webflux:
          default-filters:
            - AddResponseHeader=X-Gateway, RegistoHorasGateway
          routes:

            # üîë ROTA 1: AUTH SERVICE (P√öBLICA - Sem Filtro JWT)
            # Para endpoints de login, registo, e sa√∫de.
            - id: auth-service-public
              uri: "${URI_AUTH_SERVICE:http://localhost:8081}"
              predicates:
                # Apenas /api/auth/** deve ser p√∫blico para login/registo
                - Path=/api/auth/**

            # üõ°Ô∏è ROTA 2: AUTH SERVICE (PROTEGIDA - Com Filtro JWT)
            # Para endpoints que exigem um token v√°lido (como a rota de projetos).
            - id: auth-service-protected
              uri: "${URI_AUTH_SERVICE:http://localhost:8081}" # Aponta para o mesmo servi√ßo
              predicates:
                # Adicione aqui o endpoint que precisa de prote√ß√£o JWT
                - Path=/api/v1/projects/**, /api/v1/users/** # <-- Esta rota √© agora protegida
              filters:
                # Aplica o filtro JWT (JwtAuthFilter) para validar o token
                - JwtAuthFilter # <-- Aplica√ß√£o do filtro JWT

            # ROTA 3: MAIL SERVICE (PROTEGIDA - Permanece Inalterada)
            - id: mail-service
              uri: "${URI_MAIL_SERVICE:http://localhost:8082}"
              predicates:
                - Path=/api/email/**
              filters:
                - JwtAuthFilter

            # ROTA 4: REGISTO HORAS SERVICE (PROTEGIDA - Permanece Inalterada)
            - id: registo-horas-service
              uri: "${URI_REGISTO_HORAS:http://localhost:8083}"
              predicates:
                - Path=/actuator/**, /api/registos/**, /api-docs/**, /api/ausencias/**, /api/auditoria/**, /api/jogos/**, /api/historico/**, /api/upload-profile-pic, /api/v1/training/plan, /api/v1/**
              filters:
                - JwtAuthFilter
jwt:
  secret: ${JWT_SECRET:chave-principal-aneto-registo-horas-seguranca-2025-api-gateway}
